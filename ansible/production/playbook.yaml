- name: Ping and update
  hosts: all
  remote_user: ubuntu # ec2-user

  tasks:
    - name: Ping hosts
      ansible.builtin.ping:
  roles:
    - update

- name: Upload files to backend
  hosts: backend
  remote_user: ubuntu # ec2-user
  become: true
  become_user: root

  roles:
    - nginx
    - nodejs-latest
    - copy-folder
  vars:
    folder_dest: "$HOME/Library-app/"
    folder_src: "$HOME/Documents/Library-app/backend/"
    nginx_target: "frontend"

- name: Upload files to frontend
  hosts: frontend
  remote_user: ubuntu # ec2-user
  become: true
  become_user: root

  roles:
    - nginx
    - nodejs-latest
    - copy-folder
  vars:
    folder_dest: "$HOME/Library-app/"
    folder_src: "$HOME/Documents/Library-app/frontend/"
    nginx_target: "frontend"

- name: Set up monitor servers
  hosts: monitors
  become: true
  remote_user: ubuntu # ec2-user

  roles:
    - prometheus
    - grafana

- name: Install node-exporter
  hosts: nodeservers
  become: true
  roles:
    - node-exporter
